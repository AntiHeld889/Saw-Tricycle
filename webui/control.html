<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Saw Tricycle Websteuerung</title>
  <style>
    :root {
      color-scheme: dark;
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
    }
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #0d0d0d;
      color: #f2f2f2;
      margin: 0;
      min-height: 100vh;
      min-height: 100dvh;
      padding: calc(1.4rem + var(--safe-top)) calc(1.4rem + var(--safe-right)) calc(1.4rem + var(--safe-bottom)) calc(1.4rem + var(--safe-left));
      display: flex;
      justify-content: center;
      align-items: center;
      -webkit-text-size-adjust: 100%;
      touch-action: manipulation;
      gap: 1.2rem;
    }
    .card {
      width: 100%;
      max-width: 720px;
      background: #151515;
      border-radius: 16px;
      padding: clamp(1.2rem, 3vw + 0.4rem, 1.8rem);
      box-shadow: 0 0 40px rgba(0,0,0,0.45);
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }
    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    .card-header h1 {
      margin: 0;
      font-size: clamp(1.25rem, 2.8vw, 1.6rem);
      font-weight: 600;
    }
    .card-content {
      display: flex;
      flex-direction: column;
      gap: 1.4rem;
      align-items: center;
    }
    .info-card {
      background: rgba(255,255,255,0.04);
      border-radius: 14px;
      padding: 1.2rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      width: min(100%, 420px);
      margin: 0 auto;
    }
    .info-card h2 {
      margin: 0;
      font-size: 1.1rem;
      font-weight: 600;
    }
    .system-overview {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      align-items: center;
    }
    .system-status {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.8rem;
      flex-wrap: wrap;
      width: 100%;
    }
    .settings-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: rgba(229,9,20,0.16);
      border: 1px solid rgba(229,9,20,0.3);
      color: #fff;
      text-decoration: none;
      transition: background 0.2s ease, transform 0.2s ease, border-color 0.2s ease;
    }
    .settings-button:hover {
      background: rgba(229,9,20,0.28);
      border-color: rgba(229,9,20,0.55);
    }
    .settings-button:active {
      transform: scale(0.96);
    }
    .settings-button svg {
      width: 22px;
      height: 22px;
      fill: currentColor;
    }
    .battery-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.25rem 0.6rem 0.25rem 0.4rem;
      border-radius: 999px;
      background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.12);
      font-size: 0.82rem;
      line-height: 1;
      color: #f2f2f2;
      transition: background 0.2s ease, border-color 0.2s ease;
      text-decoration: none;
      cursor: pointer;
      align-self: center;
    }
    .battery-indicator svg {
      width: 34px;
      height: 16px;
    }
    .battery-body {
      fill: none;
      stroke: rgba(255,255,255,0.75);
      stroke-width: 2;
      stroke-linejoin: round;
    }
    .battery-cap {
      fill: rgba(255,255,255,0.75);
    }
    .battery-fill {
      fill: #36d46a;
      transition: fill 0.2s ease, width 0.2s ease;
    }
    .battery-indicator.low .battery-fill {
      fill: #ff3b30;
    }
    .battery-indicator.medium .battery-fill {
      fill: #ffcc00;
    }
    .battery-indicator.charging .battery-fill {
      fill: #33a6ff;
    }
    .battery-indicator.error .battery-fill,
    .battery-indicator.unavailable .battery-fill {
      fill: rgba(242,242,242,0.35);
    }
    .battery-indicator.unavailable {
      opacity: 0.7;
    }
    .battery-indicator span {
      min-width: 2.4rem;
      text-align: right;
      font-variant-numeric: tabular-nums;
    }
    label {
      font-size: 0.95rem;
    }
    button {
      background: #e50914;
      border: none;
      color: #fff;
      padding: 0.65rem 1.6rem;
      border-radius: 999px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
      touch-action: manipulation;
      min-height: 44px;
      -webkit-tap-highlight-color: transparent;
    }
    button:hover { background: #ff1a25; }
    button:active { transform: translateY(1px); }
    button:disabled { opacity: 0.55; cursor: not-allowed; }
    select {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.12);
      color: #fff;
      padding: 0.55rem 0.75rem;
      border-radius: 12px;
      font-size: 0.95rem;
      min-height: 44px;
    }
    select:focus {
      outline: none;
      border-color: rgba(229,9,20,0.55);
      box-shadow: 0 0 0 2px rgba(229,9,20,0.2);
    }
    footer {
      font-size: 0.8rem;
      color: #666;
      text-align: center;
    }
    @media (max-width: 900px) {
      body {
        padding: calc(1.1rem + var(--safe-top)) calc(1.1rem + var(--safe-right)) calc(1.1rem + var(--safe-bottom)) calc(1.1rem + var(--safe-left));
        align-items: stretch;
      }
      .card {
        margin: 0 auto;
        border-radius: 14px;
      }
      .card-content {
        gap: 1.2rem;
      }
      .info-card {
        padding: clamp(0.95rem, 5vw + 0.3rem, 1.4rem);
      }
    }
    @media (max-width: 720px) {
      body {
        padding: calc(0.9rem + var(--safe-top)) calc(0.9rem + var(--safe-right)) calc(1rem + var(--safe-bottom)) calc(0.9rem + var(--safe-left));
      }
      .card {
        border-radius: 12px;
        padding: clamp(1rem, 5vw + 0.3rem, 1.4rem);
      }
      .info-card {
        padding: clamp(0.85rem, 4vw, 1rem);
        gap: 0.65rem;
      }
      .system-overview {
        gap: 0.65rem;
      }
      .system-status {
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
        gap: 0.5rem;
      }
      .system-status .battery-indicator {
        flex: 1 1 55%;
        justify-content: center;
      }
      .system-status .settings-button {
        flex: 0 0 auto;
        width: 46px;
        height: 46px;
        border-radius: 12px;
      }
    }
    @media (max-width: 520px) {
      .card {
        padding: clamp(0.85rem, 5vw, 1.1rem);
      }
      .info-card {
        padding: clamp(0.75rem, 4vw, 0.95rem);
        gap: 0.75rem;
      }
      .info-card h2 {
        font-size: 1rem;
      }
      .system-status {
        gap: 0.45rem;
      }
      .system-status .battery-indicator {
        transform: scale(0.94);
        transform-origin: left center;
      }
      .settings-button {
        width: 42px;
        height: 42px;
      }
      .settings-button svg {
        width: 20px;
        height: 20px;
      }
    }
    @media (orientation: landscape) and (max-height: 520px) {
      body {
        padding: calc(0.65rem + var(--safe-top)) calc(0.7rem + var(--safe-right)) calc(0.65rem + var(--safe-bottom)) calc(0.7rem + var(--safe-left));
        align-items: stretch;
        justify-content: center;
        gap: 0.7rem;
      }
      .card {
        padding: 0.95rem;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        max-height: calc(100dvh - var(--safe-top) - var(--safe-bottom) - 1.1rem);
        overflow-y: auto;
        overscroll-behavior: contain;
      }
      .card-header h1 {
        font-size: 1.18rem;
      }
      .card-content {
        gap: 0.7rem;
      }
      .info-card {
        padding: 0.75rem;
        gap: 0.55rem;
      }
      .info-card h2 {
        margin: 0;
        font-size: 0.92rem;
      }
      .system-overview {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        justify-content: center;
        gap: 0.5rem;
      }
      .system-status {
        flex-wrap: wrap;
        justify-content: center;
        gap: 0.4rem;
      }
      .system-status .battery-indicator {
        flex: 0 1 auto;
        transform: scale(0.92);
        transform-origin: center;
      }
      .system-status .settings-button {
        width: 40px;
        height: 40px;
        border-radius: 10px;
      }
      .card footer {
        margin-top: 0.35rem;
        font-size: 0.7rem;
      }
    }
    @media (orientation: landscape) and (max-height: 430px) {
      body {
        padding: calc(0.55rem + var(--safe-top)) calc(0.6rem + var(--safe-right)) calc(0.55rem + var(--safe-bottom)) calc(0.6rem + var(--safe-left));
        gap: 0.6rem;
      }
      .card {
        padding: 0.8rem;
        gap: 0.6rem;
      }
      .card-content {
        gap: 0.55rem;
      }
    }
    @media (pointer: coarse) {
      button { font-size: 1.05rem; }
      label { font-size: 1.05rem; }
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="card-header">
      <h1>Saw Tricycle</h1>
    </div>
    <div class="card-content">
      <div class="info-card system-card">
        <h2>Übersicht</h2>
        <div class="system-overview">
          <a id="batteryIndicator" class="battery-indicator unavailable" aria-live="polite" title="Akkustand unbekannt" href="/battery">
            <svg viewBox="0 0 46 24" aria-hidden="true" focusable="false">
              <rect class="battery-body" x="1" y="5" width="36" height="14" rx="3" ry="3" />
              <rect class="battery-cap" x="38" y="9" width="6" height="6" rx="1.5" ry="1.5" />
              <rect id="batteryFill" class="battery-fill" x="3" y="7" width="0" height="10" rx="2" ry="2" />
            </svg>
            <span id="batteryLabel">--%</span>
          </a>
          <div class="system-status">
            <a id="soundboardButton" class="settings-button soundboard-button" href="#" title="Soundboard öffnen" aria-label="Soundboard öffnen" target="_blank" rel="noopener" hidden>
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path d="M3 9v6h4l5 5V4L7 9H3z"/>
                <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v8.06c1.48-.74 2.5-2.26 2.5-4.03z"/>
                <path d="M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
              </svg>
            </a>
            <a id="cameraButton" class="settings-button camera-button" href="#" title="Kamera öffnen" aria-label="Kamera öffnen" target="_blank" rel="noopener" hidden>
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path d="M4 6h3.17l1.41-1.41A2 2 0 0 1 9.83 4h4.34a2 2 0 0 1 1.41.59L17 6h3a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Zm8 3a5 5 0 1 0 0 10 5 5 0 0 0 0-10Zm0 2a3 3 0 1 1 0 6 3 3 0 0 1 0-6Z"/>
              </svg>
            </a>
            <a class="settings-button" href="#" title="Gamepad" aria-label="Gamepad">
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path d="M12 2a3 3 0 1 1 0 6 3 3 0 0 1 0-6Z"/>
                <path d="M11 7h2v5h-2z"/>
                <path d="M8.5 13h7a3.5 3.5 0 0 1 3.28 2.3l1.11 2.65A1.75 1.75 0 0 1 18.25 20h-12.5a1.75 1.75 0 0 1-1.64-2.35l1-3A3.5 3.5 0 0 1 8.5 13Z"/>
              </svg>
            </a>
            <a class="settings-button" href="/settings" title="Einstellungen" aria-label="Einstellungen öffnen">
              <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                <path d="M19.14 12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58a.5.5 0 0 0 .12-.64l-1.92-3.32a.5.5 0 0 0-.6-.22l-2.39.96a7.1 7.1 0 0 0-1.62-.94l-.36-2.54A.5.5 0 0 0 14.92 2h-3.84a.5.5 0 0 0-.5.43l-.36 2.54a7.1 7.1 0 0 0-1.62.94l-2.39-.96a.5.5 0 0 0-.6.22L3.69 8.45a.5.5 0 0 0 .12.64l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58a.5.5 0 0 0-.12.64l1.92 3.32c.14.24.43.33.68.22l2.39-.96c.49.39 1.04.71 1.62.94l.36 2.54c.04.25.25.43.5.43h3.84c.25 0 .46-.18.5-.43l.36-2.54c.58-.23 1.13-.55 1.62-.94l2.39.96c.25.11.54.02.68-.22l1.92-3.32a.5.5 0 0 0-.12-.64zm-7.14 2.56a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7z"/>
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>
    <footer>Läuft auf Port 8081</footer>
  </div>
  <script>
    const state = { audioDevice: null, audioVolume: null, soundboardPort: null, cameraTarget: null };
    const audioSelect = document.getElementById('audioDevice');
    const batteryIndicator = document.getElementById('batteryIndicator');
    const batteryFill = document.getElementById('batteryFill');
    const batteryLabel = document.getElementById('batteryLabel');
    const soundboardButton = document.getElementById('soundboardButton');
    const cameraButton = document.getElementById('cameraButton');
    const BATTERY_CLASSES = ['charging', 'low', 'medium', 'error', 'unavailable'];
    const BATTERY_MAX_WIDTH = 32;
    let audioOptionsSignature = '';
    if (audioSelect) {
      audioSelect.disabled = true;
    }

    const parseSoundboardPort = (value) => {
      if (typeof value === 'number') {
        return Number.isInteger(value) && value >= 1 && value <= 65535 ? value : null;
      }
      if (typeof value === 'string') {
        const trimmed = value.trim();
        if (!trimmed) {
          return null;
        }
        const parsed = Number.parseInt(trimmed, 10);
        if (Number.isInteger(parsed) && parsed >= 1 && parsed <= 65535) {
          return parsed;
        }
      }
      return null;
    };

    const parseCameraTarget = (value) => {
      if (typeof value === 'number') {
        if (Number.isInteger(value) && value >= 1 && value <= 65535) {
          return { port: value, path: '', raw: String(value) };
        }
        return null;
      }
      if (typeof value !== 'string') {
        return null;
      }
      const trimmed = value.trim();
      if (!trimmed) {
        return null;
      }
      const slashIndex = trimmed.indexOf('/');
      const portPart = slashIndex === -1 ? trimmed : trimmed.slice(0, slashIndex);
      const pathPart = slashIndex === -1 ? '' : trimmed.slice(slashIndex + 1);
      const numeric = Number.parseInt(portPart, 10);
      if (!Number.isInteger(numeric) || numeric < 1 || numeric > 65535) {
        return null;
      }
      let normalizedPath = '';
      if (pathPart) {
        const segments = pathPart
          .split('/')
          .map((segment) => segment.trim())
          .filter(Boolean);
        if (segments.length > 0) {
          normalizedPath = `/${segments.join('/')}`;
          if (pathPart.trim().endsWith('/') && !normalizedPath.endsWith('/')) {
            normalizedPath += '/';
          }
        }
      }
      return { port: numeric, path: normalizedPath, raw: `${numeric}${normalizedPath}` };
    };

    const buildServiceUrl = (port) => {
      const protocol = window.location.protocol === 'https:' ? 'https:' : 'http:';
      const hostname = window.location.hostname || 'localhost';
      let host = hostname;
      if (host.includes(':') && !host.startsWith('[')) {
        host = `[${host}]`;
      }
      return `${protocol}//${host}:${port}/`;
    };

    const buildSoundboardUrl = (port) => buildServiceUrl(port);
    const buildCameraUrl = (target) => {
      if (!target || !target.port) {
        return '#';
      }
      const base = buildServiceUrl(target.port);
      if (!target.path) {
        return base;
      }
      const trimmedBase = base.endsWith('/') ? base.slice(0, -1) : base;
      return `${trimmedBase}${target.path}`;
    };

    const updateSoundboardButton = (port) => {
      if (!soundboardButton) {
        return;
      }
      const numeric = parseSoundboardPort(port);
      if (numeric === null) {
        soundboardButton.hidden = true;
        soundboardButton.dataset.url = '';
        soundboardButton.removeAttribute('data-port');
        soundboardButton.href = '#';
        return;
      }
      const url = buildSoundboardUrl(numeric);
      soundboardButton.hidden = false;
      soundboardButton.dataset.url = url;
      soundboardButton.dataset.port = String(numeric);
      soundboardButton.href = url;
    };

    const updateCameraButton = (target) => {
      if (!cameraButton) {
        return;
      }
      if (!target) {
        cameraButton.hidden = true;
        cameraButton.dataset.url = '';
        cameraButton.removeAttribute('data-port');
        cameraButton.removeAttribute('data-path');
        cameraButton.removeAttribute('data-raw');
        cameraButton.href = '#';
        return;
      }
      const url = buildCameraUrl(target);
      cameraButton.hidden = false;
      cameraButton.dataset.url = url;
      cameraButton.dataset.port = String(target.port);
      if (target.path) {
        cameraButton.dataset.path = target.path;
      } else {
        cameraButton.removeAttribute('data-path');
      }
      cameraButton.dataset.raw = target.raw;
      cameraButton.href = url;
    };

    if (soundboardButton) {
      updateSoundboardButton(null);
      soundboardButton.addEventListener('click', (event) => {
        const url = soundboardButton.dataset.url;
        if (!url) {
          event.preventDefault();
          return;
        }
        event.preventDefault();
        window.open(url, '_blank', 'noopener');
      });
    }

    if (cameraButton) {
      updateCameraButton(null);
      cameraButton.addEventListener('click', (event) => {
        const url = cameraButton.dataset.url;
        if (!url) {
          event.preventDefault();
          return;
        }
        event.preventDefault();
        window.open(url, '_blank', 'noopener');
      });
    }

    const updateBattery = (info) => {
      if (!batteryIndicator || !batteryFill || !batteryLabel) {
        return;
      }
      batteryIndicator.classList.remove(...BATTERY_CLASSES);
      if (!info || typeof info !== 'object') {
        batteryLabel.textContent = '--%';
        batteryFill.setAttribute('width', '0');
        batteryIndicator.classList.add('unavailable');
        batteryIndicator.title = 'Akkustand nicht verfügbar';
        return;
      }
      const percentRaw = Number(info.percent);
      const percent = Number.isFinite(percentRaw) ? Math.max(0, Math.min(100, percentRaw)) : null;
      const voltageRaw = Number(info.voltage);
      const voltage = Number.isFinite(voltageRaw) ? voltageRaw : null;
      const currentRaw = Number(info.current);
      const current = Number.isFinite(currentRaw) ? currentRaw : null;
      const powerRaw = Number(info.power);
      const power = Number.isFinite(powerRaw) ? powerRaw : null;
      const status = typeof info.status === 'string' ? info.status : 'unknown';

      if (percent === null) {
        batteryLabel.textContent = '--%';
        batteryFill.setAttribute('width', '0');
      } else {
        batteryLabel.textContent = `${Math.round(percent)}%`;
        const width = (BATTERY_MAX_WIDTH * percent) / 100;
        batteryFill.setAttribute('width', width > 0 ? width.toFixed(1) : '0');
      }

      let indicatorClass = null;
      if (status === 'error') {
        indicatorClass = 'error';
      } else if (status === 'charging') {
        indicatorClass = 'charging';
      } else if (status === 'initializing') {
        indicatorClass = 'unavailable';
      } else if (percent === null) {
        indicatorClass = 'unavailable';
      } else if (percent <= 20) {
        indicatorClass = 'low';
      } else if (percent <= 50) {
        indicatorClass = 'medium';
      }
      if (indicatorClass) {
        batteryIndicator.classList.add(indicatorClass);
      }

      const parts = [];
      if (percent === null) {
        parts.push('Akkustand unbekannt');
      } else {
        parts.push(`Akkustand: ${Math.round(percent)}%`);
      }
      if (Number.isFinite(voltage)) {
        parts.push(`Spannung: ${voltage.toFixed(2)} V`);
      }
      if (Number.isFinite(current)) {
        parts.push(`Strom: ${current.toFixed(1)} A`);
      }
      if (Number.isFinite(power)) {
        parts.push(`Leistung: ${power.toFixed(0)} W`);
      }
      batteryIndicator.title = parts.join(' · ') || 'Akkustand unbekannt';
    };

    const syncAudioSelection = (options, selectedId) => {
      if (!audioSelect) {
        return;
      }
      const normalized = options
        .map((option) => {
          if (!option || typeof option !== 'object') {
            return null;
          }
          const id = typeof option.id === 'string' ? option.id : String(option.id ?? '');
          const label = typeof option.label === 'string' ? option.label.trim() : '';
          if (!id) {
            return null;
          }
          return { id, label: label || id };
        })
        .filter(Boolean);

      const signature = JSON.stringify(normalized);
      if (signature !== audioOptionsSignature) {
        audioOptionsSignature = signature;
        audioSelect.innerHTML = '';
        normalized.forEach((option) => {
          const opt = document.createElement('option');
          opt.value = option.id;
          opt.textContent = option.label;
          audioSelect.append(opt);
        });
      }

      const targetValue = typeof selectedId === 'string' ? selectedId : (selectedId == null ? '' : String(selectedId));
      if (audioSelect.value !== targetValue) {
        audioSelect.value = targetValue;
      }
      audioSelect.disabled = normalized.length === 0;
      state.audioDevice = targetValue || null;
    };

    async function sendState(overrides = {}) {
      const payload = {};
      const audioDevice = overrides.audioDevice ?? state.audioDevice;
      if (typeof audioDevice === 'string' && audioDevice.length > 0) {
        payload.audio_device = audioDevice;
        state.audioDevice = audioDevice;
      }
      const audioVolume = overrides.audioVolume ?? state.audioVolume;
      if (Number.isFinite(audioVolume)) {
        const normalized = Math.max(0, Math.min(100, audioVolume));
        payload.audio_volume = Math.round(normalized);
        state.audioVolume = normalized;
      }
      try {
        await fetch('/api/control', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
      } catch (err) {
        console.error('Senden fehlgeschlagen', err);
      }
    }

    if (audioSelect) {
      audioSelect.addEventListener('change', () => {
        const value = audioSelect.value;
        state.audioDevice = value || null;
        if (state.audioDevice) {
          sendState({ audioDevice: state.audioDevice });
        }
      });
    }

    async function pollState() {
      try {
        const resp = await fetch('/api/state');
        if (!resp.ok) {
          return;
        }
        const data = await resp.json();
        const remoteAudioDevice = typeof data.audio_device === 'string' ? data.audio_device : null;
        const remoteAudioOutputs = Array.isArray(data.audio_outputs) ? data.audio_outputs : [];
        syncAudioSelection(remoteAudioOutputs, remoteAudioDevice);
        if (data.audio_volume && Number.isFinite(data.audio_volume.value)) {
          state.audioVolume = data.audio_volume.value;
        } else {
          state.audioVolume = null;
        }
        updateBattery(data.battery ?? null);
        const soundInfo = data.sound && typeof data.sound === 'object' ? data.sound : null;
        const portValue = soundInfo ? parseSoundboardPort(soundInfo.soundboard_port) : null;
        const cameraValue = soundInfo ? parseCameraTarget(soundInfo.camera_port) : null;
        state.soundboardPort = portValue;
        state.cameraTarget = cameraValue;
        updateSoundboardButton(portValue);
        updateCameraButton(cameraValue);
      } catch (err) {
        console.error('Poll fehlgeschlagen', err);
      }
    }

    updateBattery(null);
    updateSoundboardButton(null);
    updateCameraButton(null);
    pollState();
    setInterval(pollState, 1500);
  </script>
</body>
</html>
